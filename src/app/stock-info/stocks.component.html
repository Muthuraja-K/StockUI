<div class="stock-info-banner">
  <h2>Stock Sector & Ticker Management</h2>
</div>

<div class="stock-info-header-controls">
  <div class="left-controls">
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input 
        type="text" 
        [(ngModel)]="filterTicker" 
        (input)="onFilterChange()" 
        placeholder="Filter by ticker..." 
      />
      <button *ngIf="filterTicker" class="clear-btn" (click)="filterTicker = ''; onFilterChange()">√ó</button>
    </div>
    
    <div class="search-box">
      <span class="search-icon">üè¢</span>
      <select [(ngModel)]="filterSector" (change)="onFilterChange()">
        <option value="">All Sectors</option>
        <option *ngFor="let sector of sectors" [value]="sector">{{ sector }}</option>
      </select>
    </div>
    
          <div class="search-box">
        <span class="search-icon">üìä</span>
        <select [(ngModel)]="filterIsXticker" (change)="onFilterChange()">
          <option value="">All Stocks</option>
          <option [ngValue]="true">Leverage</option>
          <option [ngValue]="false">Tickers</option>
        </select>
      </div>
  </div>
  
  <div class="right-controls">
    <button class="add-btn" (click)="showAddModal = true" title="Add Stock">
      <span>+</span> Add Stock
    </button>
    <button *ngIf="filterTicker || filterSector || filterIsXticker !== ''" class="clear-all-btn" (click)="clearFilters()" title="Clear all filters">
      Clear All
    </button>
  </div>
</div>

<div *ngIf="loading && filteredStocks.length === 0" class="loading-indicator">Loading...</div>

<!-- Stock Table -->
<table class="stock-info-table finviz-style" *ngIf="filteredStocks.length > 0">
  <thead>
    <tr>
      <th class="sortable-header" (click)="sortByColumn('sector')">
        Sector {{ getSortIcon('sector') }}
      </th>
      <th class="sortable-header" (click)="sortByColumn('ticker')">
        Ticker {{ getSortIcon('ticker') }}
      </th>
              <th class="sortable-header" (click)="sortByColumn('isxticker')">
          Leverage {{ getSortIcon('isxticker') }}
        </th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let stock of filteredStocks; let i = index" class="stock-row">
      <td class="sector-cell">{{ stock.sector }}</td>
      <td class="ticker-cell">
        <span class="ticker-text">{{ stock.ticker }}</span>
        <span *ngIf="stock.isxticker" class="leverage-badge">L</span>
      </td>
      <td class="type-cell">
        <span [class]="stock.isxticker ? 'xticker-badge' : 'ticker-badge'">
          {{ stock.isxticker ? 'Leverage' : 'Ticker' }}
        </span>
      </td>
      <td class="actions-cell">
        <button class="action-btn edit-btn" (click)="editStock(i)" title="Edit">
          <span>‚úèÔ∏è</span>
        </button>
        <button class="action-btn delete-btn" (click)="deleteStock(i)" title="Delete">
          <span>üóëÔ∏è</span>
        </button>
      </td>
    </tr>
  </tbody>
</table>

<div *ngIf="!loading && filteredStocks.length === 0" class="no-data">
  <p>No stocks found matching your filters.</p>
</div>

<!-- Add Stock Modal -->
<div class="modal-backdrop" *ngIf="showAddModal">
  <div class="modal">
    <h3>Add Stock</h3>
    <form (ngSubmit)="addStock()">
      <div class="form-group">
        <label>Sector</label>
        <select [(ngModel)]="newStock.sector" name="sector" required>
          <option value="">Select Sector</option>
          <option *ngFor="let sector of sectors" [value]="sector">{{ sector }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>Ticker</label>
        <input type="text" [(ngModel)]="newStock.ticker" name="ticker" placeholder="Enter ticker symbol" required />
      </div>
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="newStock.isxticker" name="isxticker" />
          <span>Leverage</span>
        </label>
      </div>
      <div class="modal-actions">
        <button type="submit" class="save-btn">Save</button>
        <button type="button" class="cancel-btn" (click)="closeAddModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Stock Modal -->
<div class="modal-backdrop" *ngIf="showEditModal" (click)="cancelEdit()">
  <div class="modal" (click)="$event.stopPropagation()">
    <h3>Edit Stock</h3>
    <form (ngSubmit)="saveEdit()">
      <div class="form-group">
        <label>Sector</label>
        <select [(ngModel)]="editingStock.sector" name="editingSector" required>
          <option value="">Select Sector</option>
          <option *ngFor="let sector of sectors" [value]="sector">{{ sector }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>Ticker</label>
        <input type="text" [(ngModel)]="editingStock.ticker" name="editingTicker" placeholder="Enter ticker symbol" required />
      </div>
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="editingStock.isxticker" name="editingIsxticker" />
          <span>Leverage</span>
        </label>
      </div>
      <div class="modal-actions">
        <button type="submit" class="save-btn">Save</button>
        <button type="button" class="cancel-btn" (click)="cancelEdit()">Cancel</button>
      </div>
    </form>
  </div>
</div> 